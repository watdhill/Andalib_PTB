// Ganti 'postgresql' dengan 'mysql' atau 'sqlite' jika berbeda
datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// ----------------------------------------------------
// ENUM DEFINITIONS
// ----------------------------------------------------

enum Gender {
  LAKI_LAKI
  PEREMPUAN
}

enum Faculty {
  HUKUM
  PERTANIAN
  KEDOKTERAN
  MIPA
  EKONOMI_BISNIS
  PETERNAKAN
  ILMU_BUDAYA
  FISIP
  TEKNIK
  FARMASI
  TEKNOLOGI_PERTANIAN
  KESEHATAN_MASYARAKAT
  KEPERAWATAN
  KEDOKTERAN_GIGI
  TEKNOLOGI_INFORMASI
}

enum Major {
  ILMU_HUKUM
  AGRIBISNIS
  AGROTEKNOLOGI
  ILMU_TANAH
  PROTEKSI_TANAMAN
  PENYULUHAN_PERTANIAN
  AGROEKOTEKNOLOGI

  PENDIDIKAN_DOKTER
  KEBIDANAN
  PSIKOLOGI
  ILMU_BIOMEDIS

  KIMIA
  BIOLOGI
  MATEMATIKA
  FISIKA

  EKONOMI
  MANAJEMEN
  AKUNTANSI

  PRODUKSI_TERNAK
  NUTRISI_DAN_MAKANAN_TERNAK

  ILMU_SEJARAH
  SASTRA_INGGRIS
  SASTRA_INDONESIA
  SASTRA_MINANGKABAU
  SASTRA_JEPANG

  ILMU_POLITIK
  SOSIOLOGI
  ANTROPOLOGI_SOSIAL
  ILMU_HUBUNGAN_INTERNASIONAL
  ILMU_KOMUNIKASI
  ADMINISTRASI_PUBLIK

  TEKNIK_MESIN
  TEKNIK_SIPIL
  TEKNIK_LINGKUNGAN
  TEKNIK_INDUSTRI
  TEKNIK_ELEKTRO

  FARMASI

  TEKNOLOGI_PANGAN_HASIL_PERTANIAN
  TEKNIK_PERTANIAN_BIOSISTEM
  TEKNOLOGI_INDUSTRI_PERTANIAN

  KESEHATAN_MASYARAKAT
  GIZI

  KEPERAWATAN

  PENDIDIKAN_DOKTER_GIGI

  SISTEM_INFORMASI
  INFORMATIKA
  TEKNIK_KOMPUTER
}

// ----------------------------------------------------
// ADMIN
// ----------------------------------------------------

model Admin {
  id         Int          @id @default(autoincrement())
  email      String       @unique
  password   String
  name       String

  Peminjaman Peminjaman[]
}

// ----------------------------------------------------
// ANGGOTA â€” PRIMARY KEY = NIM
// ----------------------------------------------------

model Anggota {
  nim               String   @id
  name              String

  gender            Gender
  faculty           Faculty
  major             Major

  contact           String
  email             String?
  photoPath         String?
  registrationDate  DateTime @default(now())

  Peminjaman        Peminjaman[]
}

// ----------------------------------------------------
// KATEGORI, BUKU, DENDA, PEMINJAMAN
// ----------------------------------------------------

model Kategori {
  id    Int    @id @default(autoincrement())
  name  String @unique

  Buku  Buku[]
}

model Buku {
  id              Int        @id @default(autoincrement())
  title           String
  author          String
  publicationYear Int?
  quantity        Int        @default(1)

  kategoriId Int
  kategori   Kategori @relation(fields: [kategoriId], references: [id])

  Peminjaman Peminjaman[]
}

model Denda {
  id           Int       @id @default(autoincrement())
  amount       Int
  reason       String?

  peminjamanId Int @unique
  peminjaman   Peminjaman @relation(fields: [peminjamanId], references: [id])
}

model Peminjaman {
  id         Int       @id @default(autoincrement())
  borrowDate DateTime  @default(now())
  dueDate    DateTime
  returnDate DateTime?
  isReturned Boolean   @default(false)

  // Relasi Buku
  bukuId     Int
  buku       Buku      @relation(fields: [bukuId], references: [id])

  // Relasi Anggota (PAKAI NIM BUKAN ID)
  anggotaNim String
  anggota    Anggota   @relation(fields: [anggotaNim], references: [nim])

  // Relasi Admin
  adminId    Int
  admin      Admin     @relation(fields: [adminId], references: [id])

  denda      Denda?
}
